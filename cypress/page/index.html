<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Registration System</title>
    <style>
        :root {
            --color-primary: #33808d;
            --color-primary-hover: #1d7480;
            --color-success: #21808d;
            --color-error: #c0152f;
            --color-warning: #a84b2f;
            --color-bg: #fcfcf9;
            --color-surface: #fffffe;
            --color-text: #133452;
            --color-text-secondary: #626c71;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-error-bg: rgba(192, 21, 47, 0.1);
            --color-success-bg: rgba(33, 128, 141, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: var(--color-surface);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: var(--color-text);
            margin-bottom: 10px;
            font-size: 28px;
            text-align: center;
        }

        .subtitle {
            color: var(--color-text-secondary);
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .alert-success {
            background: var(--color-success-bg);
            color: var(--color-success);
            border: 1px solid var(--color-success);
        }

        .alert-error {
            background: var(--color-error-bg);
            color: var(--color-error);
            border: 1px solid var(--color-error);
        }

        .alert strong {
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--color-text);
            font-weight: 500;
            font-size: 14px;
        }

        .required {
            color: var(--color-error);
            margin-left: 4px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
            background: var(--color-surface);
            color: var(--color-text);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(51, 128, 141, 0.1);
        }

        input.error, select.error {
            border-color: var(--color-error);
            background-color: var(--color-error-bg);
        }

        .error-message {
            color: var(--color-error);
            font-size: 12px;
            margin-top: 6px;
            display: none;
        }

        .error-message.show {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        .gender-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 400;
        }

        input[type="checkbox"], input[type="radio"] {
            width: auto;
            cursor: pointer;
        }

        .password-strength {
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .password-strength-bar.weak {
            width: 33%;
            background: var(--color-error);
        }

        .password-strength-bar.medium {
            width: 66%;
            background: var(--color-warning);
        }

        .password-strength-bar.strong {
            width: 100%;
            background: var(--color-success);
        }

        .password-strength-text {
            font-size: 12px;
            margin-top: 4px;
            color: var(--color-text-secondary);
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .submit-btn:hover:not(:disabled) {
            background: var(--color-primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(51, 128, 141, 0.3);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
            }
        }

        .success-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 10px;
        }

        /* ===== ENHANCED UI IMPROVEMENTS ===== */

        /* Loading Spinner Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 500;
        }

        /* Success Checkmark Animation */
        .success-checkmark {
            width: 80px;
            height: 80px;
            margin: 20px auto;
            background: #4aaf50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .checkmark {
            color: white;
            font-size: 50px;
            font-weight: bold;
            animation: checkmarkDraw 0.6s ease-out forwards;
        }

        @keyframes checkmarkDraw {
            0% {
                stroke-dashoffset: 100;
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                stroke-dashoffset: 0;
                opacity: 1;
            }
        }

        /* Field-Level Validation Icons */
        .form-group {
            position: relative;
        }

        .validation-icon {
            position: absolute;
            right: 12px;
            top: 36px;
            font-size: 20px;
            display: none;
            z-index: 10;
        }

        .validation-icon.show-valid {
            display: block;
            color: #4aaf50;
            animation: popIn 0.3s ease-out;
        }

        .validation-icon.show-invalid {
            display: block;
            color: #c0152f;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* Enhanced input focus state */
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(51, 128, 141, 0.1);
            background-color: rgba(51, 128, 141, 0.02);
        }

        /* Mobile Responsive Improvements */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                border-radius: 12px;
            }

            h1 {
                font-size: 22px;
            }

            .subtitle {
                font-size: 12px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .validation-icon {
                top: 32px;
            }

            button {
                font-size: 16px;
                padding: 12px 20px;
            }

            .loading-text {
                font-size: 16px;
            }

            .success-checkmark {
                width: 60px;
                height: 60px;
            }

            .checkmark {
                font-size: 40px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 20px;
            }

            input,
            select {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 12px;
            }

            button {
                padding: 14px 20px;
                font-size: 16px;
            }

            .error-message {
                font-size: 12px;
            }

            .alert {
                font-size: 14px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Processing Registration...</div>
    </div>

    <div class="container">
        <h1>User Registration</h1>
        <p class="subtitle">Please fill in all required fields to create your account</p>

        <div id="alertBox" class="alert"></div>

        <form id="registrationForm" novalidate>
            <div class="form-row">
                <div class="form-group">
                    <label for="firstName">First Name <span class="required">*</span></label>
                    <input type="text" id="firstName" name="firstName" required>
                    <span class="validation-icon" id="firstNameIcon"></span>
                    <div class="error-message" id="firstNameError"></div>
                </div>

                <div class="form-group">
                    <label for="lastName">Last Name <span class="required">*</span></label>
                    <input type="text" id="lastName" name="lastName" required>
                    <span class="validation-icon" id="lastNameIcon"></span>
                    <div class="error-message" id="lastNameError"></div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">Email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required>
                    <span class="validation-icon" id="emailIcon"></span>
                    <div class="error-message" id="emailError"></div>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number <span class="required">*</span></label>
                    <input type="tel" id="phone" name="phone" required>
                    <span class="validation-icon" id="phoneIcon"></span>
                    <div class="error-message" id="phoneError"></div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="age">Age</label>
                    <input type="number" id="age" name="age" min="1" max="120">
                    <span class="validation-icon" id="ageIcon"></span>
                    <div class="error-message" id="ageError"></div>
                </div>

                <div class="form-group">
                    <label>Gender <span class="required">*</span></label>
                    <div class="gender-group">
                        <label class="checkbox-label">
                            <input type="radio" id="genderMale" name="gender" value="male" required>
                            Male
                        </label>
                        <label class="checkbox-label">
                            <input type="radio" id="genderFemale" name="gender" value="female">
                            Female
                        </label>
                        <label class="checkbox-label">
                            <input type="radio" id="genderOther" name="gender" value="other">
                            Other
                        </label>
                    </div>
                    <div class="error-message" id="genderError"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="address">Address</label>
                <textarea id="address" name="address" rows="3"></textarea>
                <div class="error-message" id="addressError"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="country">Country <span class="required">*</span></label>
                    <select id="country" name="country" required>
                        <option value="">Select Country</option>
                    </select>
                    <div class="error-message" id="countryError"></div>
                </div>

                <div class="form-group">
                    <label for="state">State <span class="required">*</span></label>
                    <select id="state" name="state" required disabled>
                        <option value="">Select State</option>
                    </select>
                    <div class="error-message" id="stateError"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="city">City <span class="required">*</span></label>
                <select id="city" name="city" required disabled>
                    <option value="">Select City</option>
                </select>
                <div class="error-message" id="cityError"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="password">Password <span class="required">*</span></label>
                    <input type="password" id="password" name="password" required>
                    <span class="validation-icon" id="passwordIcon"></span>
                    <div class="password-strength">
                        <div class="password-strength-bar" id="passwordStrengthBar"></div>
                    </div>
                    <div class="password-strength-text" id="passwordStrengthText"></div>
                    <div class="error-message" id="passwordError"></div>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                    <span class="validation-icon" id="confirmPasswordIcon"></span>
                    <div class="error-message" id="confirmPasswordError"></div>
                </div>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="terms" name="terms" required>
                    I agree to the Terms &amp; Conditions <span class="required">*</span>
                </label>
                <div class="error-message" id="termsError"></div>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn" disabled>Register</button>
        </form>
    </div>

    <script>
        // Disposable email domains (sample list)
        const disposableDomains = [
            'tempmail.com', 'guerrillamail.com', 'mailinator.com', '10minutemail.com',
            'throwaway.email', 'maildrop.cc', 'yopmail.com', 'temp-mail.org',
            'getnada.com', 'mohmal.com', 'trashmail.com', 'fakeinbox.com'
        ];

        // Country phone codes - Expanded
        const phoneCountryCodes = {
            'US': ['+1'],
            'IN': ['+91'],
            'GB': ['+44'],
            'CA': ['+1'],
            'AU': ['+61'],
            'DE': ['+49'],
            'FR': ['+33'],
            'JP': ['+81'],
            'CN': ['+86'],
            'BR': ['+55'],
            'MX': ['+52'],
            'IT': ['+39'],
            'ES': ['+34'],
            'NL': ['+31'],
            'SG': ['+65'],
            'AE': ['+971']
        };

        // Location data - Expanded with more countries, states, and cities
        const locationData = {
            'US': {
                name: 'United States',
                states: {
                    'AL': { name: 'Alabama', cities: ['Birmingham', 'Montgomery', 'Mobile', 'Huntsville', 'Tuscaloosa'] },
                    'AK': { name: 'Alaska', cities: ['Anchorage', 'Fairbanks', 'Juneau', 'Sitka', 'Ketchikan'] },
                    'AZ': { name: 'Arizona', cities: ['Phoenix', 'Tucson', 'Mesa', 'Chandler', 'Scottsdale'] },
                    'AR': { name: 'Arkansas', cities: ['Little Rock', 'Fort Smith', 'Fayetteville', 'Springdale', 'Jonesboro'] },
                    'CA': { name: 'California', cities: ['Los Angeles', 'San Francisco', 'San Diego', 'Sacramento', 'San Jose', 'Fresno', 'Oakland'] },
                    'CO': { name: 'Colorado', cities: ['Denver', 'Colorado Springs', 'Aurora', 'Fort Collins', 'Boulder'] },
                    'CT': { name: 'Connecticut', cities: ['Hartford', 'New Haven', 'Stamford', 'Bridgeport', 'Waterbury'] },
                    'FL': { name: 'Florida', cities: ['Miami', 'Orlando', 'Tampa', 'Jacksonville', 'Fort Lauderdale', 'Tallahassee'] },
                    'GA': { name: 'Georgia', cities: ['Atlanta', 'Augusta', 'Columbus', 'Savannah', 'Athens'] },
                    'IL': { name: 'Illinois', cities: ['Chicago', 'Aurora', 'Naperville', 'Rockford', 'Springfield'] },
                    'MA': { name: 'Massachusetts', cities: ['Boston', 'Worcester', 'Springfield', 'Cambridge', 'Lowell'] },
                    'NY': { name: 'New York', cities: ['New York City', 'Buffalo', 'Rochester', 'Albany', 'Syracuse', 'Yonkers'] },
                    'TX': { name: 'Texas', cities: ['Houston', 'Dallas', 'Austin', 'San Antonio', 'Fort Worth', 'El Paso'] },
                    'WA': { name: 'Washington', cities: ['Seattle', 'Spokane', 'Tacoma', 'Vancouver', 'Bellevue'] }
                }
            },
            'IN': {
                name: 'India',
                states: {
                    'AP': { name: 'Andhra Pradesh', cities: ['Visakhapatnam', 'Vijayawada', 'Guntur', 'Nellore', 'Tirupati'] },
                    'AR': { name: 'Arunachal Pradesh', cities: ['Itanagar', 'Naharlagun', 'Pasighat', 'Tawang', 'Ziro'] },
                    'AS': { name: 'Assam', cities: ['Guwahati', 'Silchar', 'Dibrugarh', 'Jorhat', 'Nagaon'] },
                    'BR': { name: 'Bihar', cities: ['Patna', 'Gaya', 'Bhagalpur', 'Muzaffarpur', 'Purnia'] },
                    'CG': { name: 'Chhattisgarh', cities: ['Raipur', 'Bhilai', 'Bilaspur', 'Korba', 'Durg'] },
                    'DL': { name: 'Delhi', cities: ['New Delhi', 'Central Delhi', 'North Delhi', 'South Delhi', 'East Delhi', 'West Delhi'] },
                    'GA': { name: 'Goa', cities: ['Panaji', 'Margao', 'Vasco da Gama', 'Mapusa', 'Ponda'] },
                    'GJ': { name: 'Gujarat', cities: ['Ahmedabad', 'Surat', 'Vadodara', 'Rajkot', 'Bhavnagar'] },
                    'HR': { name: 'Haryana', cities: ['Gurgaon', 'Faridabad', 'Panipat', 'Ambala', 'Karnal'] },
                    'HP': { name: 'Himachal Pradesh', cities: ['Shimla', 'Dharamshala', 'Solan', 'Mandi', 'Kullu'] },
                    'JK': { name: 'Jammu and Kashmir', cities: ['Srinagar', 'Jammu', 'Anantnag', 'Baramulla', 'Udhampur'] },
                    'JH': { name: 'Jharkhand', cities: ['Ranchi', 'Jamshedpur', 'Dhanbad', 'Bokaro', 'Giridih'] },
                    'KA': { name: 'Karnataka', cities: ['Bangalore', 'Mysore', 'Hubli', 'Mangalore', 'Belgaum', 'Davangere'] },
                    'KL': { name: 'Kerala', cities: ['Thiruvananthapuram', 'Kochi', 'Kozhikode', 'Thrissur', 'Kollam'] },
                    'MP': { name: 'Madhya Pradesh', cities: ['Bhopal', 'Indore', 'Gwalior', 'Jabalpur', 'Ujjain'] },
                    'MH': { name: 'Maharashtra', cities: ['Mumbai', 'Pune', 'Nagpur', 'Nashik', 'Aurangabad', 'Thane'] },
                    'MN': { name: 'Manipur', cities: ['Imphal', 'Thoubal', 'Bishnupur', 'Churachandpur', 'Ukhrul'] },
                    'OR': { name: 'Odisha', cities: ['Bhubaneswar', 'Cuttack', 'Rourkela', 'Puri', 'Berhampur'] },
                    'PB': { name: 'Punjab', cities: ['Chandigarh', 'Ludhiana', 'Amritsar', 'Jalandhar', 'Patiala'] },
                    'RJ': { name: 'Rajasthan', cities: ['Jaipur', 'Jodhpur', 'Udaipur', 'Kota', 'Ajmer', 'Bikaner'] },
                    'TN': { name: 'Tamil Nadu', cities: ['Chennai', 'Coimbatore', 'Madurai', 'Tiruchirappalli', 'Salem', 'Tiruppur'] },
                    'TG': { name: 'Telangana', cities: ['Hyderabad', 'Warangal', 'Nizamabad', 'Karimnagar', 'Khammam'] },
                    'UP': { name: 'Uttar Pradesh', cities: ['Lucknow', 'Kanpur', 'Agra', 'Varanasi', 'Allahabad', 'Meerut'] },
                    'UK': { name: 'Uttarakhand', cities: ['Dehradun', 'Haridwar', 'Roorkee', 'Nainital', 'Rishikesh'] },
                    'WB': { name: 'West Bengal', cities: ['Kolkata', 'Howrah', 'Durgapur', 'Asansol', 'Siliguri'] }
                }
            },
            'GB': {
                name: 'United Kingdom',
                states: {
                    'ENG': { name: 'England', cities: ['London', 'Manchester', 'Birmingham', 'Liverpool', 'Leeds', 'Sheffield', 'Bristol', 'Newcastle'] },
                    'SCT': { name: 'Scotland', cities: ['Edinburgh', 'Glasgow', 'Aberdeen', 'Dundee', 'Inverness', 'Stirling'] },
                    'WLS': { name: 'Wales', cities: ['Cardiff', 'Swansea', 'Newport', 'Wrexham', 'Barry', 'Rhyl'] },
                    'NIR': { name: 'Northern Ireland', cities: ['Belfast', 'Derry', 'Lisburn', 'Newry', 'Armagh', 'Bangor'] }
                }
            },
            'CA': {
                name: 'Canada',
                states: {
                    'AB': { name: 'Alberta', cities: ['Calgary', 'Edmonton', 'Red Deer', 'Lethbridge', 'St. Albert'] },
                    'BC': { name: 'British Columbia', cities: ['Vancouver', 'Victoria', 'Surrey', 'Burnaby', 'Richmond', 'Kelowna'] },
                    'MB': { name: 'Manitoba', cities: ['Winnipeg', 'Brandon', 'Steinbach', 'Thompson', 'Portage la Prairie'] },
                    'NB': { name: 'New Brunswick', cities: ['Fredericton', 'Moncton', 'Saint John', 'Dieppe', 'Miramichi'] },
                    'NL': { name: 'Newfoundland and Labrador', cities: ['St. Johns', 'Mount Pearl', 'Corner Brook', 'Conception Bay South'] },
                    'NS': { name: 'Nova Scotia', cities: ['Halifax', 'Dartmouth', 'Sydney', 'Truro', 'New Glasgow'] },
                    'ON': { name: 'Ontario', cities: ['Toronto', 'Ottawa', 'Mississauga', 'Hamilton', 'London', 'Kitchener'] },
                    'PE': { name: 'Prince Edward Island', cities: ['Charlottetown', 'Summerside', 'Stratford', 'Cornwall'] },
                    'QC': { name: 'Quebec', cities: ['Montreal', 'Quebec City', 'Laval', 'Gatineau', 'Longueuil', 'Sherbrooke'] },
                    'SK': { name: 'Saskatchewan', cities: ['Regina', 'Saskatoon', 'Prince Albert', 'Moose Jaw', 'Swift Current'] }
                }
            },
            'AU': {
                name: 'Australia',
                states: {
                    'NSW': { name: 'New South Wales', cities: ['Sydney', 'Newcastle', 'Wollongong', 'Central Coast', 'Maitland', 'Tamworth'] },
                    'VIC': { name: 'Victoria', cities: ['Melbourne', 'Geelong', 'Ballarat', 'Bendigo', 'Shepparton', 'Wodonga'] },
                    'QLD': { name: 'Queensland', cities: ['Brisbane', 'Gold Coast', 'Cairns', 'Townsville', 'Toowoomba', 'Mackay'] },
                    'WA': { name: 'Western Australia', cities: ['Perth', 'Fremantle', 'Mandurah', 'Bunbury', 'Albany', 'Kalgoorlie'] },
                    'SA': { name: 'South Australia', cities: ['Adelaide', 'Mount Gambier', 'Whyalla', 'Murray Bridge', 'Port Lincoln'] },
                    'TAS': { name: 'Tasmania', cities: ['Hobart', 'Launceston', 'Devonport', 'Burnie', 'Kingston'] },
                    'NT': { name: 'Northern Territory', cities: ['Darwin', 'Alice Springs', 'Palmerston', 'Katherine', 'Nhulunbuy'] },
                    'ACT': { name: 'Australian Capital Territory', cities: ['Canberra', 'Belconnen', 'Tuggeranong', 'Weston Creek'] }
                }
            },
            'DE': {
                name: 'Germany',
                states: {
                    'BW': { name: 'Baden-Württemberg', cities: ['Stuttgart', 'Mannheim', 'Karlsruhe', 'Freiburg', 'Heidelberg'] },
                    'BY': { name: 'Bavaria', cities: ['Munich', 'Nuremberg', 'Augsburg', 'Regensburg', 'Würzburg'] },
                    'BE': { name: 'Berlin', cities: ['Berlin'] },
                    'BB': { name: 'Brandenburg', cities: ['Potsdam', 'Cottbus', 'Brandenburg', 'Frankfurt (Oder)'] },
                    'HH': { name: 'Hamburg', cities: ['Hamburg'] },
                    'HE': { name: 'Hesse', cities: ['Frankfurt', 'Wiesbaden', 'Kassel', 'Darmstadt', 'Offenbach'] },
                    'NW': { name: 'North Rhine-Westphalia', cities: ['Cologne', 'Düsseldorf', 'Dortmund', 'Essen', 'Bonn'] }
                }
            },
            'FR': {
                name: 'France',
                states: {
                    'IDF': { name: 'Île-de-France', cities: ['Paris', 'Versailles', 'Boulogne-Billancourt', 'Saint-Denis', 'Argenteuil'] },
                    'ARA': { name: 'Auvergne-Rhône-Alpes', cities: ['Lyon', 'Grenoble', 'Saint-Étienne', 'Clermont-Ferrand', 'Annecy'] },
                    'BFC': { name: 'Bourgogne-Franche-Comté', cities: ['Dijon', 'Besançon', 'Belfort', 'Chalon-sur-Saône'] },
                    'BRE': { name: 'Brittany', cities: ['Rennes', 'Brest', 'Quimper', 'Lorient', 'Vannes'] },
                    'NAQ': { name: 'Nouvelle-Aquitaine', cities: ['Bordeaux', 'Limoges', 'Poitiers', 'La Rochelle', 'Pau'] },
                    'OCC': { name: 'Occitanie', cities: ['Toulouse', 'Montpellier', 'Nîmes', 'Perpignan', 'Béziers'] },
                    'PAC': { name: 'Provence-Alpes-Côte dAzur', cities: ['Marseille', 'Nice', 'Toulon', 'Aix-en-Provence', 'Cannes'] }
                }
            },
            'JP': {
                name: 'Japan',
                states: {
                    'TKY': { name: 'Tokyo', cities: ['Shinjuku', 'Shibuya', 'Minato', 'Chiyoda', 'Setagaya'] },
                    'OSA': { name: 'Osaka', cities: ['Osaka', 'Sakai', 'Higashiosaka', 'Hirakata', 'Toyonaka'] },
                    'KYO': { name: 'Kyoto', cities: ['Kyoto', 'Uji', 'Kameoka', 'Joyo', 'Nagaokakyo'] },
                    'HOK': { name: 'Hokkaido', cities: ['Sapporo', 'Asahikawa', 'Hakodate', 'Kushiro', 'Obihiro'] },
                    'FUK': { name: 'Fukuoka', cities: ['Fukuoka', 'Kitakyushu', 'Kurume', 'Omuta', 'Iizuka'] }
                }
            },
            'CN': {
                name: 'China',
                states: {
                    'BJ': { name: 'Beijing', cities: ['Beijing', 'Haidian', 'Chaoyang', 'Fengtai', 'Shijingshan'] },
                    'SH': { name: 'Shanghai', cities: ['Shanghai', 'Pudong', 'Minhang', 'Baoshan', 'Jiading'] },
                    'GD': { name: 'Guangdong', cities: ['Guangzhou', 'Shenzhen', 'Dongguan', 'Foshan', 'Zhongshan'] },
                    'ZJ': { name: 'Zhejiang', cities: ['Hangzhou', 'Ningbo', 'Wenzhou', 'Shaoxing', 'Huzhou'] },
                    'JS': { name: 'Jiangsu', cities: ['Nanjing', 'Suzhou', 'Wuxi', 'Changzhou', 'Nantong'] }
                }
            },
            'BR': {
                name: 'Brazil',
                states: {
                    'SP': { name: 'São Paulo', cities: ['São Paulo', 'Campinas', 'Santos', 'São José dos Campos', 'Ribeirão Preto'] },
                    'RJ': { name: 'Rio de Janeiro', cities: ['Rio de Janeiro', 'Niterói', 'Duque de Caxias', 'Nova Iguaçu'] },
                    'MG': { name: 'Minas Gerais', cities: ['Belo Horizonte', 'Uberlândia', 'Contagem', 'Juiz de Fora'] },
                    'BA': { name: 'Bahia', cities: ['Salvador', 'Feira de Santana', 'Vitória da Conquista', 'Camaçari'] },
                    'PR': { name: 'Paraná', cities: ['Curitiba', 'Londrina', 'Maringá', 'Ponta Grossa', 'Cascavel'] }
                }
            },
            'MX': {
                name: 'Mexico',
                states: {
                    'CMX': { name: 'Mexico City', cities: ['Mexico City', 'Iztapalapa', 'Gustavo A. Madero', 'Coyoacán'] },
                    'JAL': { name: 'Jalisco', cities: ['Guadalajara', 'Zapopan', 'Tlaquepaque', 'Tonalá', 'Puerto Vallarta'] },
                    'NLE': { name: 'Nuevo León', cities: ['Monterrey', 'Guadalupe', 'San Nicolás de los Garza', 'Apodaca'] },
                    'PUE': { name: 'Puebla', cities: ['Puebla', 'Tehuacán', 'San Martín Texmelucan', 'Atlixco'] },
                    'GTO': { name: 'Guanajuato', cities: ['León', 'Irapuato', 'Celaya', 'Salamanca', 'Guanajuato'] }
                }
            },
            'IT': {
                name: 'Italy',
                states: {
                    'LZ': { name: 'Lazio', cities: ['Rome', 'Latina', 'Frosinone', 'Viterbo', 'Rieti'] },
                    'LM': { name: 'Lombardy', cities: ['Milan', 'Bergamo', 'Brescia', 'Monza', 'Como'] },
                    'CM': { name: 'Campania', cities: ['Naples', 'Salerno', 'Caserta', 'Benevento', 'Avellino'] },
                    'SC': { name: 'Sicily', cities: ['Palermo', 'Catania', 'Messina', 'Syracuse', 'Marsala'] },
                    'VC': { name: 'Veneto', cities: ['Venice', 'Verona', 'Padua', 'Vicenza', 'Treviso'] }
                }
            },
            'ES': {
                name: 'Spain',
                states: {
                    'MD': { name: 'Madrid', cities: ['Madrid', 'Móstoles', 'Alcalá de Henares', 'Fuenlabrada', 'Getafe'] },
                    'CT': { name: 'Catalonia', cities: ['Barcelona', 'L\'Hospitalet', 'Badalona', 'Terrassa', 'Sabadell'] },
                    'AN': { name: 'Andalusia', cities: ['Seville', 'Málaga', 'Córdoba', 'Granada', 'Jerez'] },
                    'VC': { name: 'Valencia', cities: ['Valencia', 'Alicante', 'Elche', 'Castellón', 'Torrevieja'] },
                    'PV': { name: 'Basque Country', cities: ['Bilbao', 'Vitoria-Gasteiz', 'San Sebastián', 'Barakaldo'] }
                }
            },
            'NL': {
                name: 'Netherlands',
                states: {
                    'NH': { name: 'North Holland', cities: ['Amsterdam', 'Haarlem', 'Zaanstad', 'Alkmaar', 'Haarlemmermeer'] },
                    'ZH': { name: 'South Holland', cities: ['Rotterdam', 'The Hague', 'Leiden', 'Dordrecht', 'Zoetermeer'] },
                    'NB': { name: 'North Brabant', cities: ['Eindhoven', 'Tilburg', 'Breda', '\'s-Hertogenbosch', 'Helmond'] },
                    'UT': { name: 'Utrecht', cities: ['Utrecht', 'Amersfoort', 'Nieuwegein', 'Veenendaal', 'Zeist'] }
                }
            },
            'SG': {
                name: 'Singapore',
                states: {
                    'CE': { name: 'Central', cities: ['Orchard', 'Marina Bay', 'Chinatown', 'Little India', 'Bugis'] },
                    'EA': { name: 'East', cities: ['Bedok', 'Tampines', 'Pasir Ris', 'Changi', 'Simei'] },
                    'NO': { name: 'North', cities: ['Yishun', 'Woodlands', 'Sembawang', 'Admiralty', 'Marsiling'] },
                    'WE': { name: 'West', cities: ['Jurong', 'Clementi', 'Bukit Batok', 'Choa Chu Kang', 'Tuas'] }
                }
            },
            'AE': {
                name: 'United Arab Emirates',
                states: {
                    'DU': { name: 'Dubai', cities: ['Dubai', 'Deira', 'Bur Dubai', 'Jumeirah', 'Dubai Marina'] },
                    'AZ': { name: 'Abu Dhabi', cities: ['Abu Dhabi', 'Al Ain', 'Khalifa City', 'Ruwais', 'Madinat Zayed'] },
                    'SH': { name: 'Sharjah', cities: ['Sharjah', 'Kalba', 'Khor Fakkan', 'Dibba Al-Hisn'] },
                    'AJ': { name: 'Ajman', cities: ['Ajman', 'Manama', 'Masfout'] }
                }
            }
        };

        // Form elements
        const form = document.getElementById('registrationForm');
        const submitBtn = document.getElementById('submitBtn');
        const alertBox = document.getElementById('alertBox');

        // Populate countries
        const countrySelect = document.getElementById('country');
        Object.keys(locationData).forEach(code => {
            const option = document.createElement('option');
            option.value = code;
            option.textContent = locationData[code].name;
            countrySelect.appendChild(option);
        });

        // Country change handler
        countrySelect.addEventListener('change', function() {
            const stateSelect = document.getElementById('state');
            const citySelect = document.getElementById('city');
            
            stateSelect.innerHTML = '<option value="">Select State</option>';
            citySelect.innerHTML = '<option value="">Select City</option>';
            citySelect.disabled = true;
            
            if (this.value) {
                stateSelect.disabled = false;
                const states = locationData[this.value].states;
                Object.keys(states).forEach(code => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = states[code].name;
                    stateSelect.appendChild(option);
                });
            } else {
                stateSelect.disabled = true;
            }
            
            validateField(this);
        });

        // State change handler
        document.getElementById('state').addEventListener('change', function() {
            const citySelect = document.getElementById('city');
            const countryCode = countrySelect.value;
            
            citySelect.innerHTML = '<option value="">Select City</option>';
            
            if (this.value && countryCode) {
                citySelect.disabled = false;
                const cities = locationData[countryCode].states[this.value].cities;
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            } else {
                citySelect.disabled = true;
            }
            
            validateField(this);
        });

        // City change handler
        document.getElementById('city').addEventListener('change', function() {
            validateField(this);
        });

        // Validation functions
        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(fieldId + 'Error');
            const iconElement = document.getElementById(fieldId + 'Icon');
            
            if (field) field.classList.add('error');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.add('show');
            }
            
            // Show validation icon
            if (iconElement) {
                iconElement.textContent = '✗';
                iconElement.classList.remove('show-valid');
                iconElement.classList.add('show-invalid');
            }
        }

        function clearError(fieldId) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(fieldId + 'Error');
            const iconElement = document.getElementById(fieldId + 'Icon');
            
            if (field) field.classList.remove('error');
            if (errorElement) errorElement.classList.remove('show');
            
            // Hide validation icon
            if (iconElement) {
                iconElement.classList.remove('show-invalid');
                iconElement.classList.remove('show-valid');
            }
        }

        function showValidation(fieldId) {
            const iconElement = document.getElementById(fieldId + 'Icon');
            if (iconElement) {
                iconElement.textContent = '✓';
                iconElement.classList.remove('show-invalid');
                iconElement.classList.add('show-valid');
            }
        }

        function validateField(field) {
            if (!field || !field.id) return true; // Safety check
            
            const fieldId = field.id;
            const value = field.value ? field.value.trim() : '';

            clearError(fieldId);

            // Required field validation
            if (field.hasAttribute('required') && !value) {
                if (field.type === 'radio') {
                    const checked = document.querySelector('input[name="' + field.name + '"]:checked');
                    if (!checked) {
                        showError('gender', 'Please select your gender');
                        return false;
                    }
                } else if (field.type === 'checkbox') {
                    if (!field.checked) {
                        showError(fieldId, 'This field is required');
                        return false;
                    }
                } else {
                    showError(fieldId, 'This field is required');
                    return false;
                }
            }

            // Specific validations
            if (fieldId === 'email' && value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    showError(fieldId, 'Please enter a valid email address');
                    return false;
                }

                const domain = value.split('@')[1];
                if (disposableDomains.includes(domain)) {
                    showError(fieldId, 'Disposable email addresses are not allowed');
                    return false;
                }
            }

            if (fieldId === 'phone' && value) {
                const selectedCountry = countrySelect.value;
                if (selectedCountry && phoneCountryCodes[selectedCountry]) {
                    const validCodes = phoneCountryCodes[selectedCountry];
                    const hasValidCode = validCodes.some(code => value.startsWith(code));
                    if (!hasValidCode) {
                        showError(fieldId, `Phone must start with ${validCodes.join(' or ')} for ${locationData[selectedCountry].name}`);
                        return false;
                    }
                }

                const phoneRegex = /^\+?[1-9]\d{7,14}$/;
                if (!phoneRegex.test(value.replace(/[\s-]/g, ''))) {
                    showError(fieldId, 'Please enter a valid phone number');
                    return false;
                }
            }

            if (fieldId === 'confirmPassword' && value) {
                const password = document.getElementById('password').value;
                if (value !== password) {
                    showError(fieldId, 'Passwords do not match');
                    return false;
                }
            }

            return true;
        }

        // Password strength checker
        document.getElementById('password').addEventListener('input', function() {
            const password = this.value;
            const strengthBar = document.getElementById('passwordStrengthBar');
            const strengthText = document.getElementById('passwordStrengthText');

            if (!password) {
                strengthBar.className = 'password-strength-bar';
                strengthText.textContent = '';
                return;
            }

            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^a-zA-Z0-9]/.test(password)) strength++;

            strengthBar.className = 'password-strength-bar';
            if (strength <= 2) {
                strengthBar.classList.add('weak');
                strengthText.textContent = 'Weak';
                strengthText.style.color = '#c0152f';
            } else if (strength <= 4) {
                strengthBar.classList.add('medium');
                strengthText.textContent = 'Medium';
                strengthText.style.color = '#a84b2f';
            } else {
                strengthBar.classList.add('strong');
                strengthText.textContent = 'Strong';
                strengthText.style.color = '#21808d';
            }

            validateField(this);
        });

        // Real-time validation
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                validateField(this);
                checkFormValidity();
            });
            input.addEventListener('input', function() {
                if (this.classList.contains('error')) {
                    validateField(this);
                }
                checkFormValidity();
            });
        });

        // Gender radio buttons
        const genderRadios = document.querySelectorAll('input[name="gender"]');
        genderRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                clearError('gender');
                checkFormValidity();
            });
        });

        // Terms checkbox
        document.getElementById('terms').addEventListener('change', function() {
            validateField(this);
            checkFormValidity();
        });

        // Check overall form validity
        function checkFormValidity() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const gender = document.querySelector('input[name="gender"]:checked');
            const country = document.getElementById('country').value;
            const state = document.getElementById('state').value;
            const city = document.getElementById('city').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const terms = document.getElementById('terms').checked;

            const hasErrors = document.querySelectorAll('.error').length > 0;

            const isValid = firstName && lastName && email && phone && gender && 
                          country && state && city && password && confirmPassword && 
                          terms && !hasErrors;

            submitBtn.disabled = !isValid;
        }

        // Show alert
        function showAlert(type, title, message) {
            alertBox.className = 'alert alert-' + type;
            alertBox.innerHTML = '<strong>' + title + '</strong>' + message;
            alertBox.style.display = 'block';
            alertBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            // Validate all fields
            let isValid = true;
            const requiredFields = form.querySelectorAll('[required]');
            
            requiredFields.forEach(field => {
                if (!validateField(field)) {
                    isValid = false;
                }
            });

            // Check gender
            const genderChecked = document.querySelector('input[name="gender"]:checked');
            if (!genderChecked) {
                showError('gender', 'Please select your gender');
                isValid = false;
            }

            if (!isValid) {
                showAlert('error', '❌ Error', 'Please fix all errors before submitting');
                return;
            }

            // Show loading overlay
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.classList.add('active');

            // Simulate form processing
            setTimeout(() => {
                // Log page info if Cypress is available
                if (typeof cy !== 'undefined') {
                    cy.task('logPageInfo', {
                        url: window.location.href,
                        title: document.title
                    }).then(() => {
                        completeRegistration();
                    });
                } else {
                    // Non-test environment - just complete
                    completeRegistration();
                }
            }, 1500);

            function completeRegistration() {
                // Hide loading overlay and show success
                loadingOverlay.classList.remove('active');
                showAlert('success', '✅ Registration Successful!', 'Your profile has been submitted successfully.');
                
                // Reset form after 2 seconds
                setTimeout(() => {
                    form.reset();
                    submitBtn.disabled = true;
                    document.getElementById('state').disabled = true;
                    document.getElementById('city').disabled = true;
                    document.getElementById('passwordStrengthBar').className = 'password-strength-bar';
                    document.getElementById('passwordStrengthText').textContent = '';
                    
                    // Clear all validation icons
                    document.querySelectorAll('.validation-icon').forEach(icon => {
                        icon.classList.remove('show-valid', 'show-invalid');
                        icon.textContent = '';
                    });
                    
                    setTimeout(() => {
                        alertBox.style.display = 'none';
                    }, 3000);
                }, 2000);
            }
        });

        // Initialize
        checkFormValidity();
    </script>
</body>
</html>
